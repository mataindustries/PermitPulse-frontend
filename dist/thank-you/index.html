<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
      <title>PermitPulse â€” Thank You</title>
        <link rel="icon" href="/favicon.ico">
          <style>
              body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:#f7fafc; color:#111827;}
                  .wrap{max-width:720px; margin:5rem auto; background:#fff; border-radius:16px; padding:2rem; box-shadow:0 8px 30px rgba(0,0,0,.08);}
                      h1{margin:0 0 8px;}
                          p{color:#4b5563;}
                              .row{display:flex; gap:12px; margin-top:18px; flex-wrap:wrap}
                                  .btn{display:inline-block; padding:12px 18px; border-radius:12px; border:none; cursor:pointer; text-decoration:none}
                                      .btn-primary{background:#10b981; color:#fff;}
                                          .btn-plain{background:#eef2f7; color:#111827;}
                                              .muted{color:#6b7280; font-size:14px}
                                                </style>
                                                  <!-- Google Analytics (site-wide ID) -->
                                                    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0S8S6156CV"></script>
                                                      <script>
                                                          window.dataLayer=window.dataLayer||[];
                                                              function gtag(){dataLayer.push(arguments);}
                                                                  gtag('js', new Date());
                                                                      gtag('config','G-0S8S6156CV');
                                                                        </script>
                                                                        </head>
                                                                        <body>
                                                                          <div class="wrap">
                                                                              <h1>ðŸŽ‰ Pro Activated</h1>
                                                                                  <p>Your PermitPulse Pro account is ready. CSV & alerts are unlocked.</p>
                                                                                      <div class="row">
                                                                                            <a id="go-city" class="btn btn-primary" href="/">Go to your city</a>
                                                                                                  <a class="btn btn-plain" href="/">Back to Home</a>
                                                                                                      </div>
                                                                                                          <p class="muted" id="status"></p>
                                                                                                            </div>

                                                                                                              <script>
                                                                                                                (async function(){
                                                                                                                    // API helper
                                                                                                                        async function api(path){
                                                                                                                              const res = await fetch('/api' + (path.startsWith('/')?path:'/'+path));
                                                                                                                                    if (!res.ok) throw new Error('HTTP '+res.status);
                                                                                                                                          return res.json();
                                                                                                                                              }

                                                                                                                                                  const qs = new URLSearchParams(location.search);
                                                                                                                                                      let email = (qs.get('email') || '').trim();
                                                                                                                                                          if (!email) {
                                                                                                                                                                // If Stripe didn't pass email, ask user
                                                                                                                                                                      const prev = localStorage.getItem('pp_email') || '';
                                                                                                                                                                            email = prompt('Enter your email to activate Pro:', prev) || '';
                                                                                                                                                                                }
                                                                                                                                                                                    const status = document.getElementById('status');
                                                                                                                                                                                        if (!email) { status.textContent = 'No email provided; Pro not activated.'; return; }

                                                                                                                                                                                            localStorage.setItem('pp_email', email);

                                                                                                                                                                                                // Activate plan=pro
                                                                                                                                                                                                    try {
                                                                                                                                                                                                          await api('/activate?email='+encodeURIComponent(email)+'&plan=pro');
                                                                                                                                                                                                                status.textContent = 'Pro is active for ' + email + '.';
                                                                                                                                                                                                                      // GA event
                                                                                                                                                                                                                            try { window.gtag && gtag('event','checkout_success',{method:'stripe', email}); } catch {}
                                                                                                                                                                                                                                } catch (e) {
                                                                                                                                                                                                                                      status.textContent = 'Activation failed. You still have full Pro access while we sort this out.';
                                                                                                                                                                                                                                          }

                                                                                                                                                                                                                                              // Send them to last city or Austin
                                                                                                                                                                                                                                                  const last = localStorage.getItem('pp_last_city') || 'austin';
                                                                                                                                                                                                                                                      document.getElementById('go-city').href = '/city/' + last + '/';
                                                                                                                                                                                                                                                        })();
                                                                                                                                                                                                                                                          </script>
                                                                                                                                                                                                                                                          </body>
                                                                                                                                                                                                                                                          </html>